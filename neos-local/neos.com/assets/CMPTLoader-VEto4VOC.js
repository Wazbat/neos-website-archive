import{bh as g,k as w,G as L}from"./three.module-CQU0seT4.js";import{L as P,r as d}from"./readMagicBytes-ReGFEf36.js";import{B as T}from"./B3DMLoader-BZtrZCNg.js";import{P as b}from"./PNTSLoader-gB5YPyhc.js";import{W as y,I as M}from"./I3DMLoader--guqwtSo.js";class k extends P{parse(s){const n=new DataView(s),h=d(n);console.assert(h==="cmpt",'CMPTLoader: The magic bytes equal "cmpt".');const p=n.getUint32(4,!0);console.assert(p===1,'CMPTLoader: The version listed in the header is "1".');const l=n.getUint32(8,!0);console.assert(l===s.byteLength,"CMPTLoader: The contents buffer length listed in the header matches the file.");const c=n.getUint32(12,!0),i=[];let o=16;for(let r=0;r<c;r++){const t=new DataView(s,o,12),e=d(t),a=t.getUint32(4,!0),f=t.getUint32(8,!0),u=new Uint8Array(s,o,f);i.push({type:e,buffer:u,version:a}),o+=f}return{version:p,tiles:i}}}class V extends k{constructor(s=g){super(),this.manager=s,this.adjustmentTransform=new w,this.ellipsoid=y.clone()}parse(s){const n=super.parse(s),{manager:h,ellipsoid:p,adjustmentTransform:l}=this,c=[];for(const i in n.tiles){const{type:o,buffer:r}=n.tiles[i];switch(o){case"b3dm":{const t=r.slice(),e=new T(h);e.workingPath=this.workingPath,e.fetchOptions=this.fetchOptions,e.adjustmentTransform.copy(l);const a=e.parse(t.buffer);c.push(a);break}case"pnts":{const t=r.slice(),e=new b(h);e.workingPath=this.workingPath,e.fetchOptions=this.fetchOptions;const a=e.parse(t.buffer);c.push(a);break}case"i3dm":{const t=r.slice(),e=new M(h);e.workingPath=this.workingPath,e.fetchOptions=this.fetchOptions,e.ellipsoid.copy(p),e.adjustmentTransform.copy(l);const a=e.parse(t.buffer);c.push(a);break}}}return Promise.all(c).then(i=>{const o=new L;return i.forEach(r=>{o.add(r.scene)}),{tiles:i,scene:o}})}}export{V as C};
//# sourceMappingURL=CMPTLoader-VEto4VOC.js.map
