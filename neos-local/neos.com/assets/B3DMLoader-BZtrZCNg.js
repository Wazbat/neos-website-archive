import{L as B,r as m,F as L,B as y}from"./readMagicBytes-ReGFEf36.js";import{bh as w,k as x}from"./three.module-CQU0seT4.js";import{G as C}from"./GLTFLoader-Bzr6GmPM.js";class U extends B{parse(s){const t=new DataView(s),T=m(t);console.assert(T==="b3dm");const h=t.getUint32(4,!0);console.assert(h===1);const u=t.getUint32(8,!0);console.assert(u===s.byteLength);const o=t.getUint32(12,!0),a=t.getUint32(16,!0),n=t.getUint32(20,!0),r=t.getUint32(24,!0),b=28,e=s.slice(b,b+o+a),g=new L(e,0,o,a),c=b+o+a,i=s.slice(c,c+n+r),l=new y(i,g.getData("BATCH_LENGTH"),0,n,r),f=c+n+r,p=new Uint8Array(s,f,u-f);return{version:h,featureTable:g,batchTable:l,glbBytes:p}}}class S extends U{constructor(s=w){super(),this.manager=s,this.adjustmentTransform=new x}parse(s){const t=super.parse(s),T=t.glbBytes.slice().buffer;return new Promise((h,u)=>{const o=this.manager,a=this.fetchOptions,n=o.getHandler("path.gltf")||new C(o);a.credentials==="include"&&a.mode==="cors"&&n.setCrossOrigin("use-credentials"),"credentials"in a&&n.setWithCredentials(a.credentials==="include"),a.headers&&n.setRequestHeader(a.headers);let r=this.workingPath;!/[\\/]$/.test(r)&&r.length&&(r+="/");const b=this.adjustmentTransform;n.parse(T,r,e=>{const{batchTable:g,featureTable:c}=t,{scene:i}=e,l=c.getData("RTC_CENTER",1,"FLOAT","VEC3");l&&(i.position.x+=l[0],i.position.y+=l[1],i.position.z+=l[2]),e.scene.updateMatrix(),e.scene.matrix.multiply(b),e.scene.matrix.decompose(e.scene.position,e.scene.quaternion,e.scene.scale),e.batchTable=g,e.featureTable=c,i.batchTable=g,i.featureTable=c,h(e)},u)})}}export{S as B};
//# sourceMappingURL=B3DMLoader-BZtrZCNg.js.map
